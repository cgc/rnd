# Recipe calculator bookmarklet

This bookmarklet makes it easy to tweak the quantities in a recipe! Once installed, simply click and have all recipe ingredient quantities tied together, making it easy to adjust based on what you've got at hand.

[Recipe Calculator Link](javascript:(function(){function%20parseNumber%28numberString%29%20%7Blet%20rx%20%3D%20/%5E%28%5Cd%2B%29%20%28%5Cd%2B%29%5C/%28%5Cd%2B%29%24/%3Blet%20match%20%3D%20rx.exec%28numberString%29%3Bif%20%28match%29%20%7Breturn%20parseFloat%28match%5B1%5D%29%20%2B%20parseFloat%28match%5B2%5D%29%20/%20parseFloat%28match%5B3%5D%29%3B%7Drx%20%3D%20/%5E%28%5Cd%2B%29%5C/%28%5Cd%2B%29%24/%3Bmatch%20%3D%20rx.exec%28numberString%29%3Bif%20%28match%29%20%7Breturn%20parseFloat%28match%5B1%5D%29%20/%20parseFloat%28match%5B2%5D%29%3B%7Dreturn%20parseFloat%28numberString%29%3B%7Dfunction%20parseIngredient%28ingredient%29%20%7Bconst%20rx%20%3D%20/%28%5Cd%2B%28%3F%3A%5C/%5Cd%2B%29%3F%29%28%20%5Cd%2B%5C/%5Cd%2B%29%3F/g%3Bconst%20result%20%3D%20%5B%5D%3Blet%20lastIndex%20%3D%200%3Bfunction%20addText%28match%29%20%7Bconst%20end%20%3D%20match%20%3F%20match.index%20%3A%20ingredient.length%3Bconst%20text%20%3D%20ingredient.slice%28lastIndex%2C%20end%29%3Bif%20%28text%29%20%7Bresult.push%28%7Btype%3A%20%27text%27%2Ctext%3A%20text%2C%7D%29%3B%7DlastIndex%20%3D%20end%3B%7Dlet%20matchCount%20%3D%200%3Bwhile%20%28true%29%20%7Bif%20%28matchCount%20%3E%3D%202%29%20%7Bbreak%3B%7Dconst%20match%20%3D%20rx.exec%28ingredient%29%3Bif%20%28match%20%21%3D%20null%29%20%7Blet%20open%20%3D%20ingredient.slice%280%2C%20match.index%29.match%28/%3C/g%29%20%7C%7C%20%5B%5D%3Blet%20closed%20%3D%20ingredient.slice%280%2C%20match.index%29.match%28/%3E/g%29%20%7C%7C%20%5B%5D%3Bif%20%28open.length%20%21%3D%20closed.length%29%20%7Bcontinue%3B%7D%7DaddText%28match%29%3Bif%20%28match%20%3D%3D%20null%29%20%7Bbreak%3B%7Dconst%20matchString%20%3D%20match%5B0%5D%3Bresult.push%28%7Btype%3A%20%27number%27%2Ctext%3A%20matchString%2Cvalue%3A%20parseNumber%28matchString%29%2C%7D%29%3BlastIndex%20%3D%20match.index%20%2B%20matchString.length%3BmatchCount%2B%2B%3B%7DaddText%28null%29%3Breturn%20result%3B%7Dconst%20decimalCount%20%3D%202%3Bconst%20renderSuffix%20%3D%20%7B%7D%3BrenderSuffix%5B%280%29.toFixed%28decimalCount%29.slice%281%29%5D%20%3D%20%27%27%3Bfor%20%28let%20denom%20%3D%200%3B%20denom%20%3C%2010%3B%20denom%2B%2B%29%20%7Bfor%20%28let%20numer%20%3D%200%3B%20numer%20%3C%20denom%3B%20numer%2B%2B%29%20%7Bconst%20suffix%20%3D%20%28numer/denom%29.toFixed%282%29.slice%281%29%3Bif%20%28%21renderSuffix.hasOwnProperty%28suffix%29%29%20%7BrenderSuffix%5Bsuffix%5D%20%3D%20%60%20%24%7Bnumer%7D/%24%7Bdenom%7D%60%3B%7D%7D%7Dfunction%20renderNumber%28n%29%20%7Blet%20v%20%3D%20%28n%29.toFixed%28decimalCount%29%3Bconst%20suffix%20%3D%20v.slice%28v.length%20-%20%28decimalCount%20%2B%201%29%29%3Bif%20%28renderSuffix.hasOwnProperty%28suffix%29%29%20%7Bv%20%3D%20v.slice%280%2C%20v.length-suffix.length%29%20%2B%20renderSuffix%5Bsuffix%5D%3B%7Dconst%20prefix%20%3D%20%270%20%27%3Bif%20%28v.startsWith%28prefix%29%29%20%7Bv%20%3D%20v.slice%28prefix.length%29%3B%7Dreturn%20v%3B%7Dfunction%20renderIngredient%28ingredient%2C%20ratio%29%20%7Breturn%20ingredient.map%28i%20%3D%3E%20%7Bif%20%28i.type%20%3D%3D%20%27text%27%29%20%7Breturn%20i.text%3B%7D%20else%20if%20%28i.type%20%3D%3D%20%27number%27%29%20%7Blet%20v%20%3D%20renderNumber%28ratio%2Ai.value%29%3Breturn%20%27%3Cspan%20contenteditable%20class%3D%22EditableNumber%22%20data-value%3D%22%27%2Bi.value%2B%27%22%3E%27%2Bv%2B%27%3C/span%3E%27%3B%7D%7D%29.join%28%27%27%29%3B%7Dfunction%20editNumber%28el%2C%20setRatio%29%20%7Bconst%20value%20%3D%20parseFloat%28el.dataset.value%29%3Bconst%20newValue%20%3D%20parseNumber%28el.textContent%29%3Bconst%20ratio%20%3D%20newValue%20/%20value%3BsetRatio%28ratio%29%3B%7Dfunction%20init%28%29%20%7Bconst%20defaultSelector%20%3D%20%27%5Bitemprop%3D%22recipeIngredient%22%5D%27%3Bconst%20selector%20%3D%20%7B%27cooking.nytimes.com%27%3A%20%27.recipe-ingredients%20%3E%20li%20%3E%20span%27%2C%27www.kingarthurflour.com%27%3A%20%27.recipe%20.recipe__ingredients%20ul%20li%27%2C%7D%5Bwindow.location.hostname%5D%20%7C%7C%20defaultSelector%3Bconst%20ingredients%20%3D%20Array.from%28document.querySelectorAll%28selector%29%29%3Bconst%20parsed%20%3D%20ingredients.map%28el%20%3D%3E%20parseIngredient%28el.innerHTML%29%29%3Bconst%20state%20%3D%20%7B%20%7D%3Bfunction%20setRatio%28ratio%29%20%7Bstate.ratio%20%3D%20ratio%3Bingredients.forEach%28%28el%2C%20idx%29%20%3D%3E%20%7Bel.innerHTML%20%3D%20renderIngredient%28parsed%5Bidx%5D%2C%20state.ratio%29%3B%7D%29%3B%7DsetRatio%281.%29%3Blet%20mostRecentFocus%3Bdocument.addEventListener%28%27focusin%27%2C%20function%28e%29%20%7Bif%20%28e.target.classList.contains%28%27EditableNumber%27%29%29%20%7Bconst%20p%20%3D%20e.target%3Bvar%20s%20%3D%20window.getSelection%28%29%3Bvar%20r%20%3D%20document.createRange%28%29%3Br.setStart%28p%2C%200%29%3Br.setEnd%28p%2C%201%29%3Bs.removeAllRanges%28%29%3Bs.addRange%28r%29%3BmostRecentFocus%20%3D%20el.textContent%3B%7D%7D%29%3Bdocument.addEventListener%28%27focusout%27%2C%20function%28e%29%20%7Bif%20%28e.target.classList.contains%28%27EditableNumber%27%29%29%20%7Bif%20%28el.textContent%20%21%3D%20mostRecentFocus%29%20%7BeditNumber%28e.target%2C%20setRatio%29%3B%7DmostRecentFocus%20%3D%20null%3B%7D%7D%29%3Bdocument.addEventListener%28%27keydown%27%2C%20function%28e%29%20%7Bif%20%28e.target.classList.contains%28%27EditableNumber%27%29%29%20%7Bif%20%28e.keyCode%20%3D%3D%2013%29%20%7Be.preventDefault%28%29%3BeditNumber%28e.target%2C%20setRatio%29%3B%7D%7D%7D%29%3B%7Dfunction%20addStyle%28styleString%29%20%7Bconst%20style%20%3D%20document.createElement%28%27style%27%29%3Bstyle.textContent%20%3D%20styleString%3Bdocument.head.append%28style%29%3B%7DaddStyle%28%60.EditableNumber%20%7Bborder%3A%201px%20solid%20black%3Bborder-radius%3A%202px%3Bpadding%3A%200%202px%3Bline-height%3A%201.4rem%3B%7D%60%29%3Binit%28%29%3B})();)

## Installation

On a desktop computer, drag the bookmarklet link above to your bookmarks toolbar.

On iOS,
1. Bookmark this page (tap share icon, then bookmark icon).
2. Copy this text: `javascript:(function(){function%20parseNumber%28numberString%29%20%7Blet%20rx%20%3D%20/%5E%28%5Cd%2B%29%20%28%5Cd%2B%29%5C/%28%5Cd%2B%29%24/%3Blet%20match%20%3D%20rx.exec%28numberString%29%3Bif%20%28match%29%20%7Breturn%20parseFloat%28match%5B1%5D%29%20%2B%20parseFloat%28match%5B2%5D%29%20/%20parseFloat%28match%5B3%5D%29%3B%7Drx%20%3D%20/%5E%28%5Cd%2B%29%5C/%28%5Cd%2B%29%24/%3Bmatch%20%3D%20rx.exec%28numberString%29%3Bif%20%28match%29%20%7Breturn%20parseFloat%28match%5B1%5D%29%20/%20parseFloat%28match%5B2%5D%29%3B%7Dreturn%20parseFloat%28numberString%29%3B%7Dfunction%20parseIngredient%28ingredient%29%20%7Bconst%20rx%20%3D%20/%28%5Cd%2B%28%3F%3A%5C/%5Cd%2B%29%3F%29%28%20%5Cd%2B%5C/%5Cd%2B%29%3F/g%3Bconst%20result%20%3D%20%5B%5D%3Blet%20lastIndex%20%3D%200%3Bfunction%20addText%28match%29%20%7Bconst%20end%20%3D%20match%20%3F%20match.index%20%3A%20ingredient.length%3Bconst%20text%20%3D%20ingredient.slice%28lastIndex%2C%20end%29%3Bif%20%28text%29%20%7Bresult.push%28%7Btype%3A%20%27text%27%2Ctext%3A%20text%2C%7D%29%3B%7DlastIndex%20%3D%20end%3B%7Dlet%20matchCount%20%3D%200%3Bwhile%20%28true%29%20%7Bif%20%28matchCount%20%3E%3D%202%29%20%7Bbreak%3B%7Dconst%20match%20%3D%20rx.exec%28ingredient%29%3Bif%20%28match%20%21%3D%20null%29%20%7Blet%20open%20%3D%20ingredient.slice%280%2C%20match.index%29.match%28/%3C/g%29%20%7C%7C%20%5B%5D%3Blet%20closed%20%3D%20ingredient.slice%280%2C%20match.index%29.match%28/%3E/g%29%20%7C%7C%20%5B%5D%3Bif%20%28open.length%20%21%3D%20closed.length%29%20%7Bcontinue%3B%7D%7DaddText%28match%29%3Bif%20%28match%20%3D%3D%20null%29%20%7Bbreak%3B%7Dconst%20matchString%20%3D%20match%5B0%5D%3Bresult.push%28%7Btype%3A%20%27number%27%2Ctext%3A%20matchString%2Cvalue%3A%20parseNumber%28matchString%29%2C%7D%29%3BlastIndex%20%3D%20match.index%20%2B%20matchString.length%3BmatchCount%2B%2B%3B%7DaddText%28null%29%3Breturn%20result%3B%7Dconst%20decimalCount%20%3D%202%3Bconst%20renderSuffix%20%3D%20%7B%7D%3BrenderSuffix%5B%280%29.toFixed%28decimalCount%29.slice%281%29%5D%20%3D%20%27%27%3Bfor%20%28let%20denom%20%3D%200%3B%20denom%20%3C%2010%3B%20denom%2B%2B%29%20%7Bfor%20%28let%20numer%20%3D%200%3B%20numer%20%3C%20denom%3B%20numer%2B%2B%29%20%7Bconst%20suffix%20%3D%20%28numer/denom%29.toFixed%282%29.slice%281%29%3Bif%20%28%21renderSuffix.hasOwnProperty%28suffix%29%29%20%7BrenderSuffix%5Bsuffix%5D%20%3D%20%60%20%24%7Bnumer%7D/%24%7Bdenom%7D%60%3B%7D%7D%7Dfunction%20renderNumber%28n%29%20%7Blet%20v%20%3D%20%28n%29.toFixed%28decimalCount%29%3Bconst%20suffix%20%3D%20v.slice%28v.length%20-%20%28decimalCount%20%2B%201%29%29%3Bif%20%28renderSuffix.hasOwnProperty%28suffix%29%29%20%7Bv%20%3D%20v.slice%280%2C%20v.length-suffix.length%29%20%2B%20renderSuffix%5Bsuffix%5D%3B%7Dconst%20prefix%20%3D%20%270%20%27%3Bif%20%28v.startsWith%28prefix%29%29%20%7Bv%20%3D%20v.slice%28prefix.length%29%3B%7Dreturn%20v%3B%7Dfunction%20renderIngredient%28ingredient%2C%20ratio%29%20%7Breturn%20ingredient.map%28i%20%3D%3E%20%7Bif%20%28i.type%20%3D%3D%20%27text%27%29%20%7Breturn%20i.text%3B%7D%20else%20if%20%28i.type%20%3D%3D%20%27number%27%29%20%7Blet%20v%20%3D%20renderNumber%28ratio%2Ai.value%29%3Breturn%20%27%3Cspan%20contenteditable%20class%3D%22EditableNumber%22%20data-value%3D%22%27%2Bi.value%2B%27%22%3E%27%2Bv%2B%27%3C/span%3E%27%3B%7D%7D%29.join%28%27%27%29%3B%7Dfunction%20editNumber%28el%2C%20setRatio%29%20%7Bconst%20value%20%3D%20parseFloat%28el.dataset.value%29%3Bconst%20newValue%20%3D%20parseNumber%28el.textContent%29%3Bconst%20ratio%20%3D%20newValue%20/%20value%3BsetRatio%28ratio%29%3B%7Dfunction%20init%28%29%20%7Bconst%20defaultSelector%20%3D%20%27%5Bitemprop%3D%22recipeIngredient%22%5D%27%3Bconst%20selector%20%3D%20%7B%27cooking.nytimes.com%27%3A%20%27.recipe-ingredients%20%3E%20li%20%3E%20span%27%2C%27www.kingarthurflour.com%27%3A%20%27.recipe%20.recipe__ingredients%20ul%20li%27%2C%7D%5Bwindow.location.hostname%5D%20%7C%7C%20defaultSelector%3Bconst%20ingredients%20%3D%20Array.from%28document.querySelectorAll%28selector%29%29%3Bconst%20parsed%20%3D%20ingredients.map%28el%20%3D%3E%20parseIngredient%28el.innerHTML%29%29%3Bconst%20state%20%3D%20%7B%20%7D%3Bfunction%20setRatio%28ratio%29%20%7Bstate.ratio%20%3D%20ratio%3Bingredients.forEach%28%28el%2C%20idx%29%20%3D%3E%20%7Bel.innerHTML%20%3D%20renderIngredient%28parsed%5Bidx%5D%2C%20state.ratio%29%3B%7D%29%3B%7DsetRatio%281.%29%3Blet%20mostRecentFocus%3Bdocument.addEventListener%28%27focusin%27%2C%20function%28e%29%20%7Bif%20%28e.target.classList.contains%28%27EditableNumber%27%29%29%20%7Bconst%20p%20%3D%20e.target%3Bvar%20s%20%3D%20window.getSelection%28%29%3Bvar%20r%20%3D%20document.createRange%28%29%3Br.setStart%28p%2C%200%29%3Br.setEnd%28p%2C%201%29%3Bs.removeAllRanges%28%29%3Bs.addRange%28r%29%3BmostRecentFocus%20%3D%20el.textContent%3B%7D%7D%29%3Bdocument.addEventListener%28%27focusout%27%2C%20function%28e%29%20%7Bif%20%28e.target.classList.contains%28%27EditableNumber%27%29%29%20%7Bif%20%28el.textContent%20%21%3D%20mostRecentFocus%29%20%7BeditNumber%28e.target%2C%20setRatio%29%3B%7DmostRecentFocus%20%3D%20null%3B%7D%7D%29%3Bdocument.addEventListener%28%27keydown%27%2C%20function%28e%29%20%7Bif%20%28e.target.classList.contains%28%27EditableNumber%27%29%29%20%7Bif%20%28e.keyCode%20%3D%3D%2013%29%20%7Be.preventDefault%28%29%3BeditNumber%28e.target%2C%20setRatio%29%3B%7D%7D%7D%29%3B%7Dfunction%20addStyle%28styleString%29%20%7Bconst%20style%20%3D%20document.createElement%28%27style%27%29%3Bstyle.textContent%20%3D%20styleString%3Bdocument.head.append%28style%29%3B%7DaddStyle%28%60.EditableNumber%20%7Bborder%3A%201px%20solid%20black%3Bborder-radius%3A%202px%3Bpadding%3A%200%202px%3Bline-height%3A%201.4rem%3B%7D%60%29%3Binit%28%29%3B})();`
3. Go to bookmarks and tap "edit". Change the address to the bookmark you make in step 1 to the code.

## Supported sites:

- [New York Times Cooking](https://cooking.nytimes.com/)
- [King Arthur Flour](https://www.kingarthurflour.com/recipes)
- All websites with [schema.org](https://schema.org/)-compliant usage of `recipeIngredient`. Includes Smitten Kitchen.

## Developer

Build new version of README with
```
python make.py
```
